{{- if .Values.secrets.useExternal }}
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: {{ .Release.Name }}-vault-store
spec:
  provider:
    vault:
      server: "https://vault.kubepractice.ru"
      path: "team1/hr-assist"
      version: "v2"

      auth:
        userPass:
          path: "userpass"
          username:
            name: vault-credentials
            key: username
          password:
            name: vault-credentials
            key: password

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ .Release.Name }}-secrets
spec:
  refreshInterval: 1m
  secretStoreRef:
    kind: SecretStore
    name: {{ .Release.Name }}-vault-store

  target:
    name: {{ .Release.Name }}-secrets
    creationPolicy: Owner
    deletionPolicy: Retain

  data:
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: team1/hr-assist
        property: OPENAI_API_KEY

    - secretKey: KC_CLIENT_SECRET
      remoteRef:
        key: team1/hr-assist
        property: KC_CLIENT_SECRET

    - secretKey: RABBITMQ_DEFAULT_PASS
      remoteRef:
        key: team1/hr-assist
        property: RABBITMQ_DEFAULT_PASS

    - secretKey: POSTGRES_PASSWORD
      remoteRef:
        key: team1/hr-assist
        property: POSTGRES_PASSWORD
{{- end }}
